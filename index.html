<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>スト6コンボ入力ツール</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { 
      background: #fff; 
      color: #000; 
      font-family: Arial, sans-serif; 
      margin: 0; 
      padding: 10px; 
      font-size: 14px;
    }
    h1 { 
      text-align: center; 
      color: #000; 
      margin-bottom: 12px; 
      white-space: nowrap;
      font-size: clamp(20px, 6vw, 36px);
    }
    .readme-note {
      text-align: center;
      margin-bottom: 15px;
      font-size: 14px;
    }
    .container { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 15px; 
      max-width: 1200px; /* Increased from 800px to 1200px (1.5x) */
      margin: 0 auto;
    }
    .panel { 
      background: #f2f2f2; 
      border: 1px solid #888; 
      border-radius: 10px; 
      padding: 15px; 
      box-sizing: border-box; 
      flex: 1 1 calc(50% - 8px);
      min-width: 400px; /* Adjusted from 480px to 400px for better fit */
    }
    .mode-toggle-container {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-bottom: 10px;
    }
    .section-title { 
      font-size: 16px; 
      border-bottom: 1px solid #aaa; 
      margin-bottom: 8px;
      padding-bottom: 4px;
    }
    .mode-section {
      flex: 1;
      min-width: 180px; /* Increased from 120px to 180px (1.5x) */
    }
    
    .mode-select {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .mode-select label {
      margin-right: 5px;
      font-size: 14px;
    }
    .button-grid { 
      display: grid; 
      gap: 6px; 
      margin-bottom: 12px; 
      width: 100%;
    }
    /* ボタングリッドの調整 */
    .grid-3x3 { 
      grid-template-columns: repeat(3, minmax(auto, 1fr)); 
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }
    .grid-4x2 { 
      grid-template-columns: repeat(4, minmax(auto, 1fr)); 
      width: 100%;
      max-width: 350px;
      margin: 0 auto;
    }
    .grid-3x2 { 
      grid-template-columns: repeat(3, minmax(auto, 1fr)); 
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }
    .grid-3x1 { 
      grid-template-columns: repeat(3, minmax(auto, 1fr)); 
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }
    .grid-1x1 { 
      grid-template-columns: 1fr; 
    }
    
    .grid-4x4-special { 
      grid-template-columns: repeat(4, minmax(auto, 1fr)); 
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }
    
    /* 特殊入力ボタンを4列に変更 */
    #specialInputs {
      grid-template-columns: repeat(4, minmax(auto, 1fr)); 
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }
    
    .row { 
      display: flex; 
      gap: 15px; 
      margin-bottom: 15px; 
    }
    .column { 
      flex: 1;
      max-width: 50%;
      min-width: 0; /* Allows columns to shrink below their content size if needed */
    }
    
    button { 
      font-size: 14px; 
      padding: 8px; 
      background: #fff; 
      color: #000; 
      border: 1px solid #888; 
      border-radius: 5px; 
      cursor: pointer; 
      white-space: nowrap; /* テキストの改行を防止 */
      text-overflow: ellipsis; /* 必要に応じてテキストを省略 */
      overflow: hidden; /* 必要に応じてオーバーフローを隠す */
      min-width: min-content; /* ボタンの最小幅を内容に合わせる */
      width: 100%; /* ボタン幅を親要素いっぱいに */
      box-sizing: border-box; /* パディングとボーダーを幅に含める */
    }
    button:hover { background: #ddd; }
    
    .display-box { 
      background: #fff; 
      padding: 12px; 
      border: 1px solid #ccc; 
      border-radius: 10px; 
      min-height: 60px; 
      white-space: pre-wrap; 
      font-size: 16px; 
      margin-bottom: 8px; 
    }
    .memo-box { 
      width: 100%; 
      padding: 8px; 
      font-size: 14px; 
      border-radius: 8px; 
      border: 1px solid #aaa; 
      background: #fff; 
      color: #000; 
      margin-bottom: 8px; 
      box-sizing: border-box;
      resize: vertical;
    }
	.control { 
	  display: flex; 
	  gap: 6px; 
	  flex-wrap: nowrap; 
	  margin-bottom: 8px; 
	  justify-content: space-between; 
	}
    .divider { 
      border: none; 
      border-top: 1px solid #888; 
      margin: 10px 0; 
    }
    .github-icon { 
      position: fixed; 
      top: 10px; 
      right: 10px; 
      z-index: 1000; 
    }
    
    .custom-input-container {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
    }
    
    .custom-input-field {
      flex: 1;
      padding: 8px;
      border: 1px solid #aaa;
      border-radius: 5px;
      font-size: 14px;
    }
    
    /* 技ボタンのスタイル */
    .btn-attack {
      color: #fff;
      border: 1px solid #888;
      border-radius: 5px;
      cursor: pointer;
    }
    
    /* キャンセルラッシュなど長いテキストを持つボタン用 */
    .long-text-button {
      font-size: 12px;
      padding: 6px 4px;
    }
    
    /* モダンモードのボタンサイズ調整 */
    #modernButtons {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      max-width: 350px;
      margin: 0 auto;
    }
    
    #modernButtons button {
      width: 100%;
      height: 100%;
      min-height: 36px;
    }
    
    /* アシストボタンを横幅いっぱいに */
    #modernButtons button:last-child {
      grid-column: 1 / -1;
    }
    .btn-small { background-color: #4583a8; }
    .btn-middle { background-color: #979829; }
    .btn-large { background-color: #c36264; }
    .btn-pk-essential { background-color: #eb6e00; }
    
    .btn-attack:hover {
      opacity: 0.9;
    }
    
    /* 折りたたみ機能 */
    .collapsible {
      cursor: pointer;
      position: relative;
      padding-right: 25px;
    }
    
    .collapsible::after {
      content: '▼';
      font-size: 12px;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      transition: transform 0.3s;
    }
    
    .collapsed::after {
      transform: translateY(-50%) rotate(-90deg);
    }
    
    .collapsible-content {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height 0.4s ease-in-out;
    }
    
    .collapsed + .collapsible-content {
      max-height: 0;
    }
    
    /* メディアクエリでスマートフォン対応 */
    @media (max-width: 900px) { /* Adjusted to 900px to ensure horizontal layout at 1000px width */
      .row, .mode-toggle-container { flex-direction: column; }
      
      .column {
        max-width: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      .column > div {
        width: 100%;
      }
      
      .section-title {
        text-align: center;
      }
    }
    
    /* スマートフォン固有のサイズ調整 */
    @media (min-width: 375px) and (max-width: 642px) { /* Increased max from 428px to 642px (1.5x) */
      .container {
        gap: 10px;
      }
      
      .panel {
        padding: 10px;
        flex: 1 1 100%;
        min-width: auto;
      }
      
      button {
        font-size: 12px;
        padding: 6px 4px;
        min-width: min-content;
        width: 100%;
      }
      
      .button-grid {
        gap: 4px;
      }
      
      .long-text-button {
        font-size: 11px;
        padding: 5px 3px;
        letter-spacing: -0.5px;
      }
    }
  </style>
</head>
<body>
  <h1>スト6 コンボ入力ツール</h1>
  <p class="readme-note">
    大まかな使い方は、<a href="https://github.com/HatoAttack/sf6-command-input" target="_blank">GitHubリポジトリ</a>を読んでください。
  </p>
  
  <div class="container">
    <div class="panel">
      <!-- モード切替（横並び） -->
      <div class="mode-toggle-container">
        <div class="mode-section">
          <div class="section-title">表示モード切替</div>
          <div class="mode-select">
            <label><input type="radio" name="mode" value="arrow" checked> 矢印</label>
            <label><input type="radio" name="mode" value="number"> 数字</label>
          </div>
        </div>
        <div class="mode-section">
          <div class="section-title">操作モード切替</div>
          <div class="mode-select">
            <label><input type="radio" name="style" value="classic" checked> クラシック</label>
            <label><input type="radio" name="style" value="modern"> モダン</label>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="column" id="direction-area">
          <div class="section-title">方向キー</div>
          <!-- 3×3グリッド（方向キー） -->
          <div class="button-grid grid-3x3" id="directionGrid"></div>
          
          <hr class="divider">
          
          <!-- 特殊方向入力 -->
          <div class="button-grid grid-3x2" id="specialDirections"></div>
        </div>
        
        <div class="column" id="attack-area">
          <!-- クラシックボタン -->
          <div id="classic-buttons">
            <div class="section-title">技ボタン（クラシック）</div>
            <div class="button-grid grid-4x2" id="classicButtons"></div>
            <hr class="divider">
            <div class="button-grid grid-3x3" id="saButtons"></div>
            <hr class="divider">
            <div class="button-grid grid-3x1" id="specialCommandButtons"></div>
          </div>
          
          <!-- モダンボタン -->
          <div id="modern-buttons" style="display:none;">
            <div class="section-title">技ボタン（モダン）</div>
            <div id="modernButtons"></div>
            <hr class="divider">
            <div class="button-grid grid-3x3" id="saButtonsModern"></div>
            <hr class="divider">
            <div class="button-grid grid-3x1" id="specialCommandButtonsModern"></div>
          </div>
        </div>
      </div>
      
      <div class="section-title collapsible" id="specialInputsHeader">特殊入力</div>
      <div class="collapsible-content">
        <div class="button-grid grid-4x4-special" id="specialInputs"></div>
      </div>
      
      <div class="section-title collapsible" id="customInputHeader">任意入力</div>
      <div class="collapsible-content">
        <div class="custom-input-container">
          <button id="customInputButton" onclick="addCustomInput()">任意入力追加</button>
          <input type="text" id="customInputField" class="custom-input-field" placeholder="任意の入力を入力">
        </div>
      </div>
    </div>
    
    <div class="panel">
      <div class="section-title">出力</div>
      <div class="display-box" id="output"></div>
      <div class="section-title">メモ</div>
      <textarea class="memo-box" id="memo" rows="4" placeholder="フレーム数や解説を入力"></textarea>
      <div class="control">
        <button onclick="undoOutput()">戻る</button>
        <button onclick="addInput('\n')">改行</button>
        <button onclick="copyOutput()">コピー</button>
        <button onclick="clearOutput()">クリア</button>
      </div>
      
      <div class="section-title">保存機能</div>
		<div class="control">
		  <input type="file" id="fileInput" onchange="handleFileSelect(event)" accept=".csv"/>
		  <button onclick="saveCurrentCombo()">コンボ保存</button>
		  <button onclick="exportCombosToCSV(savedCombos)">CSVエクスポート</button>
</div>

    </div>
  </div>
  
  <script>
    // 定数
    const ARROW_MAP = {
      '1': '↙', '2': '↓', '3': '↘',
      '4': '←', '5': 'N', '6': '→',
      '7': '↖', '8': '↑', '9': '↗'
    };
    
    // UI要素の参照
    const directionGrid = document.getElementById('directionGrid');
    const specialDirections = document.getElementById('specialDirections');
    const classicButtons = document.getElementById('classicButtons');
    const modernButtons = document.getElementById('modernButtons');
    const saButtons = document.getElementById('saButtons');
    const saButtonsModern = document.getElementById('saButtonsModern');
    const specialInputs = document.getElementById('specialInputs');
    const specialCommandButtons = document.getElementById('specialCommandButtons');
    const specialCommandButtonsModern = document.getElementById('specialCommandButtonsModern');
    const additionalInputs = document.getElementById('additionalInputs');
    const outputBox = document.getElementById('output');
    const memoBox = document.getElementById('memo');
    const customInputField = document.getElementById('customInputField');
    
    // 状態管理
    let output = '';
    let history = [];
    let lastWasDirection = false;
    let customText = "";
    let savedCombos = [];
    let untitledCounter = 1;
    
    // 方向キーグリッド初期化
    function initDirectionGrid() {
      for (let i = 7; i <= 9; i++) {
        createDirectionButton(i);
      }
      for (let i = 4; i <= 6; i++) {
        createDirectionButton(i);
      }
      for (let i = 1; i <= 3; i++) {
        createDirectionButton(i);
      }
    }
    
    function createDirectionButton(value) {
      const button = document.createElement('button');
      button.className = 'direction-button';
      button.setAttribute('data-value', value);
      button.textContent = ARROW_MAP[value];
      button.onclick = () => addInput(value.toString());
      directionGrid.appendChild(button);
    }
    
    // 特殊方向入力初期化
    function initSpecialDirections() {
      const commands = [
        { text: '波動', value: '236' },
        { text: '昇龍', value: '623' },
        { text: '竜巻', value: '214' },
        { text: '逆昇龍', value: '412' },
        { text: 'ヨガ', value: '41236' },
        { text: '逆ヨガ', value: '63214' },
        { text: 'タメ', value: 'タメ' },
        { text: '1回転', value: '1回転' },
        { text: '2回転', value: '2回転' }
      ];
      
      commands.forEach(cmd => {
        const button = document.createElement('button');
        button.textContent = cmd.text;
        button.onclick = () => addInput(cmd.value);
        specialDirections.appendChild(button);
      });
    }
    
    // 特殊コマンドボタン初期化
    function initSpecialCommandButtons() {
      const commands = [
        { text: '＋', value: '+' },
        { text: '＞(次)', value: ' > ' }
      ];
      
      // クラシックモード用
      const container = document.getElementById('specialCommandButtons');
      commands.forEach(cmd => {
        const button = document.createElement('button');
        button.textContent = cmd.text;
        button.onclick = () => addInput(cmd.value);
        container.appendChild(button);
      });
      
      // 3つ目のボタンはプレースホルダーとして追加（グリッドを整える）
      const placeholderButton = document.createElement('button');
      placeholderButton.style.visibility = 'hidden';
      container.appendChild(placeholderButton);
      
      // モダンモード用も同じボタンを複製
      const containerModern = document.getElementById('specialCommandButtonsModern');
      commands.forEach(cmd => {
        const button = document.createElement('button');
        button.textContent = cmd.text;
        button.onclick = () => addInput(cmd.value);
        containerModern.appendChild(button);
      });
      
      // 3つ目のボタンはプレースホルダーとして追加（グリッドを整える）
      const placeholderButtonModern = document.createElement('button');
      placeholderButtonModern.style.visibility = 'hidden';
      containerModern.appendChild(placeholderButtonModern);
    }
    
    // 攻撃ボタン初期化
    function initAttackButtons() {
      // クラシック
      const classicAttacks = [
        { text: 'P', value: 'P', class: 'btn-pk-essential' },
        { text: '小P', value: '小P', class: 'btn-small' },
        { text: '中P', value: '中P', class: 'btn-middle' },
        { text: '大P', value: '大P', class: 'btn-large' },
        { text: 'K', value: 'K', class: 'btn-pk-essential' },
        { text: '小K', value: '小K', class: 'btn-small' },
        { text: '中K', value: '中K', class: 'btn-middle' },
        { text: '大K', value: '大K', class: 'btn-large' }
      ];
      
      classicAttacks.forEach(atk => {
        const button = document.createElement('button');
        button.textContent = atk.text;
        button.className = `btn-attack ${atk.class}`;
        button.onclick = () => addInput(atk.value, true);
        classicButtons.appendChild(button);
      });
      
      // モダン
      const modernAttacks = [
        { text: '弱', value: '弱', class: 'btn-small' },
        { text: '中', value: '中', class: 'btn-middle' },
        { text: '強', value: '強', class: 'btn-large' },
        { text: '必殺', value: '必殺', class: 'btn-pk-essential' },
        { text: 'アシスト', value: 'アシスト', class: '' }
      ];
      
      // グリッドを直接使わず、modernButtonsにスタイルを適用
      modernAttacks.forEach(atk => {
        const button = document.createElement('button');
        button.textContent = atk.text;
        if (atk.class) button.className = `btn-attack ${atk.class}`;
        button.onclick = () => addInput(atk.value, true);
        modernButtons.appendChild(button);
      });
      
      // SA技 (両方のモードで同じ)
      const createSAButtons = (container) => {
        for (let i = 1; i <= 3; i++) {
          const button = document.createElement('button');
          button.textContent = `SA${i}`;
          button.onclick = () => addInput(` SA${i} `);
          container.appendChild(button);
        }
      };
      
      createSAButtons(saButtons);
      createSAButtons(saButtonsModern);
    }
    
    // 特殊入力初期化
    function initSpecialInputs() {
      const inputs = [
        { text: 'キャンセルラッシュ', value: '(CR)', longText: true },
        { text: 'ドライブラッシュ', value: '(DR)', longText: true },
        { text: 'ジャンプ', value: 'J' },
        { text: '前ジャンプ', value: '前J' },
        { text: '前ステ', value: '(前ステ)' },
        { text: '近距離', value: '(近距離)' },
        { text: '遅らせ', value: '(遅らせ)' },
        { text: '微歩き', value: '(微歩き)' },
        { text: 'カウンター時', value: '(カウンター時)' },
        { text: 'パニカン時', value: '(パニカン時)' }
      ];
      
      inputs.forEach(inp => {
        const button = document.createElement('button');
        button.textContent = inp.text;
        if (inp.longText) {
          button.className = 'long-text-button';
        }
        button.onclick = () => addInput(inp.value);
        specialInputs.appendChild(button);
      });
    }
    
    // ユーティリティ関数
    function getMode() {
      return document.querySelector('input[name="mode"]:checked').value;
    }
    
    function convertToArrow(seq) {
      return seq.split('').map(c => ARROW_MAP[c] || c).join('');
    }
    
    // 入力処理
    function addInput(value, isAttack = false) {
      history.push(output);
      let mode = getMode();
      let insert = value;
      
      if (!isNaN(value)) {
        insert = (mode === 'arrow') ? convertToArrow(value) : value;
        lastWasDirection = true;
      } else if (isAttack && lastWasDirection) {
        insert = (mode === 'arrow') ? '+' + value : value;
        lastWasDirection = false;
      } else {
        lastWasDirection = false;
      }
      
      output += insert;
      outputBox.textContent = output;
      saveState();
    }
    
    // 任意入力関連
    function addCustomInput() {
      const inputValue = customInputField.value.trim();
      
      if (inputValue === "") {
        alert("入力内容を入力してください");
        return;
      }
      
      addInput(inputValue);
      customInputField.value = ""; // 入力後にフィールドをクリア
    }
    
    function customInput() {
      if (customText === "") {
        let userInput = prompt("任意の入力をしてください");
        if (userInput !== null && userInput.trim() !== "") {
          customText = userInput.trim();
          let btn = document.getElementById("customInputButton");
          btn.textContent = customText;
          btn.style.color = "red";
        } else {
          return;
        }
      }
      addInput(customText);
    }
    
    function undoOutput() {
      if (history.length > 0) {
        output = history.pop();
        outputBox.textContent = output;
        saveState();
      }
    }
    
    function copyOutput() {
      navigator.clipboard.writeText(output + '\n' + memoBox.value);
      alert('コピーしました');
    }
    
    function clearOutput() {
      output = '';
      outputBox.textContent = '';
      memoBox.value = '';
      lastWasDirection = false;
      history = [];
      localStorage.removeItem('sf6_output');
      localStorage.removeItem('sf6_memo');
    }
    
    function saveState() {
      localStorage.setItem('sf6_output', output);
      localStorage.setItem('sf6_memo', memoBox.value);
    }
    
    function convertOutputMode() {
      let mode = getMode();
      let newOutput = output;
      
      if (mode === 'arrow') {
        newOutput = newOutput.replace(/[123456789]/g, m => ARROW_MAP[m]);
        newOutput = newOutput.replace(/([↖↗↙↘←→↑↓N])([A-Za-z一-龥])/g, '$1+$2');
      } else {
        const reverseMap = Object.fromEntries(Object.entries(ARROW_MAP).map(([k, v]) => [v, k]));
        newOutput = newOutput.replace(/[↖↗↙↘←→↑↓N]/g, m => reverseMap[m] || m);
        newOutput = newOutput.replace(/([1-9])\+([A-Za-z一-龥])/g, '$1$2');
      }
      
      output = newOutput;
      outputBox.textContent = output;
      saveState();
    }
    
    // 方向キー表示更新
    function updateDirectionButtons() {
      const mode = getMode();
      const buttons = document.querySelectorAll('.direction-button');
      
      buttons.forEach(button => {
        const value = button.getAttribute('data-value');
        button.textContent = mode === 'arrow' ? (ARROW_MAP[value] || value) : value;
      });
    }
    
    // 保存・読み込み機能
    function formatDate() {
      let now = new Date();
      let year = now.getFullYear();
      let month = String(now.getMonth() + 1).padStart(2, '0');
      let day = String(now.getDate()).padStart(2, '0');
      let hour = String(now.getHours()).padStart(2, '0');
      let minute = String(now.getMinutes()).padStart(2, '0');
      return `${year}-${month}-${day}T${hour}:${minute}`;
    }
    
    function generateID() {
      let now = new Date();
      let dateStr = now.getFullYear() +
                    String(now.getMonth() + 1).padStart(2, '0') +
                    String(now.getDate()).padStart(2, '0') +
                    String(now.getHours()).padStart(2, '0') +
                    String(now.getMinutes()).padStart(2, '0');
      return parseInt(dateStr, 10).toString(16);
    }
    
    function saveCurrentCombo() {
      let combo = output;
      let memoText = memoBox.value;
      
      if (combo.trim() === "") {
        alert("コンボが入力されていません。");
        return;
      }
      
      let titleInput = prompt("コンボのタイトルを入力してください。（空欄の場合は自動で『無題』が割り当てられます）");
      if (titleInput === null) return;
      
      let title = titleInput.trim() === "" ? "無題" + untitledCounter++ : titleInput.trim();
      let nowFormatted = formatDate();
      
      // 同じタイトルのエントリがあれば上書き
      let existing = savedCombos.find(item => item.title === title);
      if (existing) {
        existing.combo = combo;
        existing.memo = memoText;
        existing.updatedAt = nowFormatted;
        alert("既存のコンボを上書きしました。");
      } else {
        savedCombos.push({
          id: generateID(),
          title: title,
          combo: combo,
          memo: memoText,
          createdAt: nowFormatted,
          updatedAt: nowFormatted
        });
        alert("新しいコンボが保存されました。");
      }
    }
    
    function exportCombosToCSV(comboArray) {
      if (comboArray.length === 0) {
        alert("保存されたコンボがありません。");
        return;
      }
      
      let csvContent = "ID,タイトル,コンボ,メモ,作成日時,更新日時\n";
      comboArray.forEach(item => {
        csvContent += `${item.id},${item.title},${item.combo},${item.memo},${item.createdAt},${item.updatedAt}\n`;
      });
      
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "combos.csv";
      a.click();
      URL.revokeObjectURL(url);
    }
    
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.split("\n").filter(line => line.trim() !== "");
        
        if (lines.length <= 1) {
          alert("有効なコンボデータがCSVに見つかりませんでした。");
          return;
        }
        
        let newCombos = [];
        for (let i = 1; i < lines.length; i++) {
          const [id, title, combo, memo, createdAt, updatedAt] = lines[i].split(",");
          if (id) {
            newCombos.push({ id, title, combo, memo, createdAt, updatedAt });
          }
        }
        
        savedCombos = newCombos;
        alert(`${newCombos.length}件のコンボデータが読み込まれました。`);
      };
      
      reader.readAsText(file, "UTF-8");
    }
    
    // イベントリスナー設定
    document.querySelectorAll('input[name="mode"]').forEach(radio => {
      radio.addEventListener('change', () => {
        convertOutputMode();
        updateDirectionButtons();
      });
    });
    
    document.querySelectorAll('input[name="style"]').forEach(radio => {
      radio.addEventListener('change', () => {
        const style = document.querySelector('input[name="style"]:checked').value;
        document.getElementById('classic-buttons').style.display = (style === 'classic') ? 'block' : 'none';
        document.getElementById('modern-buttons').style.display = (style === 'modern') ? 'block' : 'none';
      });
    });
    
    // Enterキーで「＞」入力（テキスト入力欄以外のフォーカス時）
    document.addEventListener("keydown", function(event) {
      if (document.activeElement !== memoBox && 
          document.activeElement !== customInputField && 
          event.key === "Enter") {
        event.preventDefault();
        addInput(' > ');
      }
    });
    
    // 折りたたみ機能の初期化
    function initCollapsibles() {
      const collapsibles = document.querySelectorAll('.collapsible');
      
      collapsibles.forEach(item => {
        // クリックイベントを追加
        item.addEventListener('click', function() {
          this.classList.toggle('collapsed');
          
          // ローカルストレージに状態を保存
          const id = this.id;
          if (id) {
            localStorage.setItem(`sf6_collapsed_${id}`, this.classList.contains('collapsed'));
          }
        });
        
        // ローカルストレージから状態を復元
        const id = item.id;
        if (id && localStorage.getItem(`sf6_collapsed_${id}`) === 'true') {
          item.classList.add('collapsed');
        }
      });
    }
    
    // 初期化
    function init() {
      initDirectionGrid();
      initSpecialDirections();
      initAttackButtons();
      initSpecialInputs();
      initSpecialCommandButtons();
      initCollapsibles();
      updateDirectionButtons();
      
      // ローカルストレージから復元
      const savedOutput = localStorage.getItem('sf6_output');
      const savedMemo = localStorage.getItem('sf6_memo');
      
      if (savedOutput) {
        output = savedOutput;
        outputBox.textContent = output;
      }
      
      if (savedMemo) {
        memoBox.value = savedMemo;
      }
    }
    
    // アプリ起動
    init();
  </script>
</body>
</html>